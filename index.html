<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>JSONT Tutorial</title>

		<script src="lib/codemirror.js"></script>
		<link rel="stylesheet" href="lib/codemirror.css">
		<link rel="stylesheet" href="theme/monokai.css">
		<link rel="stylesheet" href="styles/styles.css">
		<script src="mode/javascript/javascript.js"></script>
		<script src="mode/xml/xml.js"></script>
		<script src="mode/css/css.js"></script>
		<script src="mode/htmlmixed/htmlmixed.js"></script>
	</head>

	<body>
		
		<div id="editorOne">
			<div id="editor"></div>
			<button id="check">Submit Answer</button>
		</div>

		<div id="editorTwo">
			<div id="compare"></div>
		</div>

	</body>

	<script type="text/javascript">
		// attach the .equals method to Array's prototype to call it on any array
		Array.prototype.equals = function (array) {
		    // if the other array is a falsy value, return
		    if (!array)
		        return false;

		    // compare lengths - can save a lot of time 
		    if (this.length != array.length)
		        return false;

		    for (var i = 0, l=this.length; i < l; i++) {
		        // Check if we have nested arrays
		        if (this[i] instanceof Array && array[i] instanceof Array) {
		            // recurse into the nested arrays
		            if (!this[i].equals(array[i]))
		                return false;       
		        }           
		        else if (this[i] != array[i]) { 
		            // Warning - two different object instances will never be equal: {x:20} != {x:20}
		            return false;   
		        }           
		    }       
		    return true;
		}  


		var inputArea = document.getElementById('editor');
		var compareArea = document.getElementById('compare');
		var button = document.getElementById('check');

		var editor = CodeMirror(function(elt){
			inputArea.parentNode.replaceChild(elt, inputArea);
		}, {
			value: 'begin typing',
  		lineNumbers: true,
  		mode: 'htmlmixed',
  		theme: 'monokai',
  		autofocus: true
		});

		var compareEditor = CodeMirror(function(elt){
			compareArea.parentNode.replaceChild(elt, compareArea);
		}, {
			value: '{.section website}\n<h1>{siteTitle}</h1>\n{.end}',
  		lineNumbers: true,
  		mode: 'htmlmixed',
  		theme: 'monokai',
  		autofocus: true
		});

		var answer = compareEditor.getValue().split(/\s+(?![^\[]*\]|[^(]*\)|[^\{]*})/);
		answer = answer.filter(function(n){ return n != '' });
		var input;

		button.addEventListener('click', function(e){
			input = editor.getValue().split(/\s+(?![^\[]*\]|[^(]*\)|[^\{]*})/);
			input = input.filter(function(n){ return n != '' });

			if(input.equals(answer)){
				alert('correct!');
			} else {
				alert('wrong LOL');
			}

		});



	</script>

</html>

